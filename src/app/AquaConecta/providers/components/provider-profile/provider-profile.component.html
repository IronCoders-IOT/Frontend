<app-header-content></app-header-content>

<div class="profile-container">
    <div class="profile-header">
        <h1 class="profile-title">Provider Profile</h1>
        <div class="action-buttons">
            <button *ngIf="!isEditing" class="btn-edit" (click)="toggleEditMode()">
                Edit Profile
            </button>
            <div *ngIf="isEditing" class="edit-buttons">
                <button class="btn-cancel" (click)="toggleEditMode()">
                    Cancel
                </button>
                <button class="btn-save" [disabled]="profileForm.invalid || submitInProgress" (click)="onSubmit()">
                    {{ submitInProgress ? 'Saving...' : 'Save Changes' }}
                </button>
            </div>
        </div>
    </div>

    <div class="profile-card" *ngIf="!isLoading; else loadingTemplate">
        <form [formGroup]="profileForm">
            <div class="form-layout">
                <!-- First column -->
                <div class="form-column">
                    <div class="form-group">
                        <label for="tax_name">Company Name</label>
                        <input type="text" id="tax_name" formControlName="tax_name" class="form-control"
                            [ngClass]="{'invalid': hasError('tax_name', 'required')}">
                        <div class="error-message" *ngIf="hasError('tax_name', 'required')">
                            Company name is required
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="ruc">RUC</label>
                        <input type="text" id="ruc" formControlName="ruc" class="form-control"
                            [ngClass]="{'invalid': hasError('ruc', 'required') || hasError('ruc', 'pattern')}">
                        <div class="error-message" *ngIf="hasError('ruc', 'required')">
                            RUC is required
                        </div>
                        <div class="error-message" *ngIf="hasError('ruc', 'pattern')">
                            RUC must be 11 digits
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="sensors_number">Number of Sensors</label>
                        <input type="number" id="sensors_number" formControlName="sensors_number" class="form-control"
                            [ngClass]="{'invalid': hasError('sensors_number', 'min')}">
                        <div class="error-message" *ngIf="hasError('sensors_number', 'min')">
                            Number of sensors must be positive
                        </div>
                    </div>
                </div>

                <!-- Second column -->
                <div class="form-column">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" formControlName="email" class="form-control"
                            [ngClass]="{'invalid': hasError('email', 'required') || hasError('email', 'email')}">
                        <div class="error-message" *ngIf="hasError('email', 'required')">
                            Email is required
                        </div>
                        <div class="error-message" *ngIf="hasError('email', 'email')">
                            Please enter a valid email
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input type="text" id="phone" formControlName="phone" class="form-control"
                            [ngClass]="{'invalid': hasError('phone', 'required') || hasError('phone', 'pattern')}">
                        <div class="error-message" *ngIf="hasError('phone', 'required')">
                            Phone is required
                        </div>
                        <div class="error-message" *ngIf="hasError('phone', 'pattern')">
                            Phone must be 9 digits
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" id="address" formControlName="address" class="form-control"
                            [ngClass]="{'invalid': hasError('address', 'required')}">
                        <div class="error-message" *ngIf="hasError('address', 'required')">
                            Address is required
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <div class="card-actions">
            <button class="btn-view-details" (click)="goToDetails()">
                View Active Plans
            </button>
        </div>
    </div>

    <ng-template #loadingTemplate>
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading provider information...</p>
        </div>
    </ng-template>
</div>